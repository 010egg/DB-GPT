"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[717],{78385:function(e,l,t){t.d(l,{h:function(){return u}});var o=t(67294),n=t(73935),a=t(33703),r=t(73546),i=t(7960),d=t(85893);let u=o.forwardRef(function(e,l){let{children:t,container:u,disablePortal:s=!1}=e,[c,v]=o.useState(null),p=(0,a.Z)(o.isValidElement(t)?t.ref:null,l);return((0,r.Z)(()=>{!s&&v(("function"==typeof u?u():u)||document.body)},[u,s]),(0,r.Z)(()=>{if(c&&!s)return(0,i.Z)(l,c),()=>{(0,i.Z)(l,null)}},[l,c,s]),s)?o.isValidElement(t)?o.cloneElement(t,{ref:p}):(0,d.jsx)(o.Fragment,{children:t}):(0,d.jsx)(o.Fragment,{children:c?n.createPortal(t,c):c})})},70758:function(e,l,t){t.d(l,{U:function(){return d}});var o=t(87462),n=t(67294),a=t(99962),r=t(33703),i=t(30437);function d(e={}){let{disabled:l=!1,focusableWhenDisabled:t,href:d,rootRef:u,tabIndex:s,to:c,type:v}=e,p=n.useRef(),[m,h]=n.useState(!1),{isFocusVisibleRef:f,onFocus:b,onBlur:x,ref:y}=(0,a.Z)(),[g,w]=n.useState(!1);l&&!t&&g&&w(!1),n.useEffect(()=>{f.current=g},[g,f]);let[T,S]=n.useState(""),Z=e=>l=>{var t;g&&l.preventDefault(),null==(t=e.onMouseLeave)||t.call(e,l)},j=e=>l=>{var t;x(l),!1===f.current&&w(!1),null==(t=e.onBlur)||t.call(e,l)},k=e=>l=>{var t,o;p.current||(p.current=l.currentTarget),b(l),!0===f.current&&(w(!0),null==(o=e.onFocusVisible)||o.call(e,l)),null==(t=e.onFocus)||t.call(e,l)},_=()=>{let e=p.current;return"BUTTON"===T||"INPUT"===T&&["button","submit","reset"].includes(null==e?void 0:e.type)||"A"===T&&(null==e?void 0:e.href)},N=e=>t=>{if(!l){var o;null==(o=e.onClick)||o.call(e,t)}},z=e=>t=>{var o;l||(h(!0),document.addEventListener("mouseup",()=>{h(!1)},{once:!0})),null==(o=e.onMouseDown)||o.call(e,t)},R=e=>t=>{var o,n;null==(o=e.onKeyDown)||o.call(e,t),!t.defaultMuiPrevented&&(t.target!==t.currentTarget||_()||" "!==t.key||t.preventDefault(),t.target!==t.currentTarget||" "!==t.key||l||h(!0),t.target!==t.currentTarget||_()||"Enter"!==t.key||l||(null==(n=e.onClick)||n.call(e,t),t.preventDefault()))},C=e=>t=>{var o,n;t.target===t.currentTarget&&h(!1),null==(o=e.onKeyUp)||o.call(e,t),t.target!==t.currentTarget||_()||l||" "!==t.key||t.defaultMuiPrevented||null==(n=e.onClick)||n.call(e,t)},E=n.useCallback(e=>{var l;S(null!=(l=null==e?void 0:e.tagName)?l:"")},[]),M=(0,r.Z)(E,u,y,p),P={};return void 0!==s&&(P.tabIndex=s),"BUTTON"===T?(P.type=null!=v?v:"button",t?P["aria-disabled"]=l:P.disabled=l):""!==T&&(d||c||(P.role="button",P.tabIndex=null!=s?s:0),l&&(P["aria-disabled"]=l,P.tabIndex=t?null!=s?s:0:-1)),{getRootProps:(l={})=>{let t=(0,o.Z)({},(0,i._)(e),(0,i._)(l)),n=(0,o.Z)({type:v},t,P,l,{onBlur:j(t),onClick:N(t),onFocus:k(t),onKeyDown:R(t),onKeyUp:C(t),onMouseDown:z(t),onMouseLeave:Z(t),ref:M});return delete n.onFocusVisible,n},focusVisible:g,setFocusVisible:w,active:m,rootRef:M}}},27015:function(e,l,t){var o=t(64836);l.Z=void 0;var n=o(t(64938)),a=t(85893),r=(0,n.default)((0,a.jsx)("path",{d:"M14 2H4c-1.11 0-2 .9-2 2v10h2V4h10V2zm4 4H8c-1.11 0-2 .9-2 2v10h2V8h10V6zm2 4h-8c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2z"}),"AutoAwesomeMotion");l.Z=r},76043:function(e,l,t){var o=t(67294);let n=o.createContext(void 0);l.Z=n},58859:function(e,l,t){t.d(l,{V:function(){return n}});var o=t(87462);let n=({theme:e,ownerState:l},t)=>{let n={};return l.sx&&(function l(t){if("function"==typeof t){let o=t(e);l(o)}else Array.isArray(t)?t.forEach(e=>{"boolean"!=typeof e&&l(e)}):"object"==typeof t&&(n=(0,o.Z)({},n,t))}(l.sx),t.forEach(l=>{let t=n[l];if("string"==typeof t||"number"==typeof t){if("borderRadius"===l){if("number"==typeof t)n[l]=`${t}px`;else{var o;n[l]=(null==(o=e.vars)?void 0:o.radius[t])||t}}else -1!==["p","padding","m","margin"].indexOf(l)&&"number"==typeof t?n[l]=e.spacing(t):n[l]=t}else"function"==typeof t?n[l]=t(e):n[l]=void 0})),n}},53913:function(e,l,t){t.r(l),t.d(l,{default:function(){return X}});var o=t(85893),n=t(67294),a=t(577),r=t(61685),i=t(63366),d=t(87462),u=t(90512),s=t(14142),c=t(19032),v=t(92996),p=t(59948),m=t(99962),h=t(33703),f=t(94780),b=t(9572),x=t(74312),y=t(20407),g=t(30220),w=t(78653),T=t(26821);function S(e){return(0,T.d6)("MuiTooltip",e)}(0,T.sI)("MuiTooltip",["root","tooltipArrow","arrow","touch","placementLeft","placementRight","placementTop","placementBottom","colorPrimary","colorDanger","colorNeutral","colorSuccess","colorWarning","colorContext","sizeSm","sizeMd","sizeLg","variantPlain","variantOutlined","variantSoft","variantSolid"]);let Z=["children","className","component","arrow","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","disablePortal","direction","keepMounted","modifiers","placement","title","color","variant","size","slots","slotProps"],j=e=>{let{arrow:l,variant:t,color:o,size:n,placement:a,touch:r}=e,i={root:["root",l&&"tooltipArrow",r&&"touch",n&&`size${(0,s.Z)(n)}`,o&&`color${(0,s.Z)(o)}`,t&&`variant${(0,s.Z)(t)}`,`tooltipPlacement${(0,s.Z)(a.split("-")[0])}`],arrow:["arrow"]};return(0,f.Z)(i,S,{})},k=(0,x.Z)("div",{name:"JoyTooltip",slot:"Root",overridesResolver:(e,l)=>l.root})(({ownerState:e,theme:l})=>{var t,o,n;let a=null==(t=l.variants[e.variant])?void 0:t[e.color];return(0,d.Z)({},"sm"===e.size&&{"--Icon-fontSize":l.vars.fontSize.md,"--Tooltip-arrowSize":"8px",padding:l.spacing(.25,.625)},"md"===e.size&&{"--Icon-fontSize":l.vars.fontSize.lg,"--Tooltip-arrowSize":"10px",padding:l.spacing(.5,.75)},"lg"===e.size&&{"--Icon-fontSize":l.vars.fontSize.xl,"--Tooltip-arrowSize":"12px",padding:l.spacing(.75,1)},{zIndex:l.vars.zIndex.tooltip,borderRadius:l.vars.radius.sm,boxShadow:l.shadow.sm,wordWrap:"break-word",position:"relative"},e.disableInteractive&&{pointerEvents:"none"},l.typography[`body-${({sm:"xs",md:"sm",lg:"md"})[e.size]}`],a,!a.backgroundColor&&{backgroundColor:l.vars.palette.background.surface},{"&::before":{content:'""',display:"block",position:"absolute",width:null!=(o=e.placement)&&o.match(/(top|bottom)/)?"100%":"calc(10px + var(--variant-borderWidth, 0px))",height:null!=(n=e.placement)&&n.match(/(top|bottom)/)?"calc(10px + var(--variant-borderWidth, 0px))":"100%"},'&[data-popper-placement*="bottom"]::before':{top:0,left:0,transform:"translateY(-100%)"},'&[data-popper-placement*="left"]::before':{top:0,right:0,transform:"translateX(100%)"},'&[data-popper-placement*="right"]::before':{top:0,left:0,transform:"translateX(-100%)"},'&[data-popper-placement*="top"]::before':{bottom:0,left:0,transform:"translateY(100%)"}})}),_=(0,x.Z)("span",{name:"JoyTooltip",slot:"Arrow",overridesResolver:(e,l)=>l.arrow})(({theme:e,ownerState:l})=>{var t,o,n;let a=null==(t=e.variants[l.variant])?void 0:t[l.color];return{"--unstable_Tooltip-arrowRotation":0,width:"var(--Tooltip-arrowSize)",height:"var(--Tooltip-arrowSize)",boxSizing:"border-box","&:before":{content:'""',display:"block",position:"absolute",width:0,height:0,border:"calc(var(--Tooltip-arrowSize) / 2) solid",borderLeftColor:"transparent",borderBottomColor:"transparent",borderTopColor:null!=(o=null==a?void 0:a.backgroundColor)?o:e.vars.palette.background.surface,borderRightColor:null!=(n=null==a?void 0:a.backgroundColor)?n:e.vars.palette.background.surface,borderRadius:"0px 2px 0px 0px",boxShadow:`var(--variant-borderWidth, 0px) calc(-1 * var(--variant-borderWidth, 0px)) 0px 0px ${a.borderColor}`,transformOrigin:"center center",transform:"rotate(calc(-45deg + 90deg * var(--unstable_Tooltip-arrowRotation)))"},'[data-popper-placement*="bottom"] &':{top:"calc(0.5px + var(--Tooltip-arrowSize) * -1 / 2)"},'[data-popper-placement*="top"] &':{"--unstable_Tooltip-arrowRotation":2,bottom:"calc(0.5px + var(--Tooltip-arrowSize) * -1 / 2)"},'[data-popper-placement*="left"] &':{"--unstable_Tooltip-arrowRotation":1,right:"calc(0.5px + var(--Tooltip-arrowSize) * -1 / 2)"},'[data-popper-placement*="right"] &':{"--unstable_Tooltip-arrowRotation":3,left:"calc(0.5px + var(--Tooltip-arrowSize) * -1 / 2)"}}}),N=!1,z=null,R={x:0,y:0};function C(e,l){return t=>{l&&l(t),e(t)}}function E(e,l){return t=>{l&&l(t),e(t)}}let M=n.forwardRef(function(e,l){var t;let a=(0,y.Z)({props:e,name:"JoyTooltip"}),{children:r,className:s,component:f,arrow:x=!1,describeChild:T=!1,disableFocusListener:S=!1,disableHoverListener:M=!1,disableInteractive:P=!1,disableTouchListener:q=!1,enterDelay:D=100,enterNextDelay:O=0,enterTouchDelay:A=700,followCursor:B=!1,id:F,leaveDelay:L=0,leaveTouchDelay:I=1500,onClose:V,onOpen:U,open:W,disablePortal:$,direction:K,keepMounted:Y,modifiers:H,placement:J="bottom",title:X,color:G="neutral",variant:Q="solid",size:ee="md",slots:el={},slotProps:et={}}=a,eo=(0,i.Z)(a,Z),{getColor:en}=(0,w.VT)(Q),ea=$?en(e.color,G):G,[er,ei]=n.useState(),[ed,eu]=n.useState(null),es=n.useRef(!1),ec=P||B,ev=n.useRef(),ep=n.useRef(),em=n.useRef(),eh=n.useRef(),[ef,eb]=(0,c.Z)({controlled:W,default:!1,name:"Tooltip",state:"open"}),ex=ef,ey=(0,v.Z)(F),eg=n.useRef(),ew=n.useCallback(()=>{void 0!==eg.current&&(document.body.style.WebkitUserSelect=eg.current,eg.current=void 0),clearTimeout(eh.current)},[]);n.useEffect(()=>()=>{clearTimeout(ev.current),clearTimeout(ep.current),clearTimeout(em.current),ew()},[ew]);let eT=e=>{z&&clearTimeout(z),N=!0,eb(!0),U&&!ex&&U(e)},eS=(0,p.Z)(e=>{z&&clearTimeout(z),z=setTimeout(()=>{N=!1},800+L),eb(!1),V&&ex&&V(e),clearTimeout(ev.current),ev.current=setTimeout(()=>{es.current=!1},150)}),eZ=e=>{es.current&&"touchstart"!==e.type||(er&&er.removeAttribute("title"),clearTimeout(ep.current),clearTimeout(em.current),D||N&&O?ep.current=setTimeout(()=>{eT(e)},N?O:D):eT(e))},ej=e=>{clearTimeout(ep.current),clearTimeout(em.current),em.current=setTimeout(()=>{eS(e)},L)},{isFocusVisibleRef:ek,onBlur:e_,onFocus:eN,ref:ez}=(0,m.Z)(),[,eR]=n.useState(!1),eC=e=>{e_(e),!1===ek.current&&(eR(!1),ej(e))},eE=e=>{er||ei(e.currentTarget),eN(e),!0===ek.current&&(eR(!0),eZ(e))},eM=e=>{es.current=!0;let l=r.props;l.onTouchStart&&l.onTouchStart(e)};n.useEffect(()=>{if(ex)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)};function e(e){("Escape"===e.key||"Esc"===e.key)&&eS(e)}},[eS,ex]);let eP=(0,h.Z)(ei,l),eq=(0,h.Z)(ez,eP),eD=(0,h.Z)(r.ref,eq);"number"==typeof X||X||(ex=!1);let eO=n.useRef(null),eA={},eB="string"==typeof X;T?(eA.title=ex||!eB||M?null:X,eA["aria-describedby"]=ex?ey:null):(eA["aria-label"]=eB?X:null,eA["aria-labelledby"]=ex&&!eB?ey:null);let eF=(0,d.Z)({},eA,eo,{component:f},r.props,{className:(0,u.Z)(s,r.props.className),onTouchStart:eM,ref:eD},B?{onMouseMove:e=>{let l=r.props;l.onMouseMove&&l.onMouseMove(e),R={x:e.clientX,y:e.clientY},eO.current&&eO.current.update()}}:{}),eL={};q||(eF.onTouchStart=e=>{eM(e),clearTimeout(em.current),clearTimeout(ev.current),ew(),eg.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",eh.current=setTimeout(()=>{document.body.style.WebkitUserSelect=eg.current,eZ(e)},A)},eF.onTouchEnd=e=>{r.props.onTouchEnd&&r.props.onTouchEnd(e),ew(),clearTimeout(em.current),em.current=setTimeout(()=>{eS(e)},I)}),M||(eF.onMouseOver=C(eZ,eF.onMouseOver),eF.onMouseLeave=C(ej,eF.onMouseLeave),ec||(eL.onMouseOver=eZ,eL.onMouseLeave=ej)),S||(eF.onFocus=E(eE,eF.onFocus),eF.onBlur=E(eC,eF.onBlur),ec||(eL.onFocus=eE,eL.onBlur=eC));let eI=(0,d.Z)({},a,{arrow:x,disableInteractive:ec,placement:J,touch:es.current,color:ea,variant:Q,size:ee}),eV=j(eI),eU=(0,d.Z)({},eo,{component:f,slots:el,slotProps:et}),eW=n.useMemo(()=>[{name:"arrow",enabled:!!ed,options:{element:ed,padding:6}},{name:"offset",options:{offset:[0,10]}},...H||[]],[ed,H]),[e$,eK]=(0,g.Z)("root",{additionalProps:(0,d.Z)({id:ey,popperRef:eO,placement:J,anchorEl:B?{getBoundingClientRect:()=>({top:R.y,left:R.x,right:R.x,bottom:R.y,width:0,height:0})}:er,open:!!er&&ex,disablePortal:$,keepMounted:Y,direction:K,modifiers:eW},eL),ref:null,className:eV.root,elementType:k,externalForwardedProps:eU,ownerState:eI}),[eY,eH]=(0,g.Z)("arrow",{ref:eu,className:eV.arrow,elementType:_,externalForwardedProps:eU,ownerState:eI}),eJ=(0,o.jsxs)(e$,(0,d.Z)({},eK,!(null!=(t=a.slots)&&t.root)&&{as:b.r,slots:{root:f||"div"}},{children:[X,x?(0,o.jsx)(eY,(0,d.Z)({},eH)):null]}));return(0,o.jsxs)(n.Fragment,{children:[n.isValidElement(r)&&n.cloneElement(r,eF),$?eJ:(0,o.jsx)(w.ZP.Provider,{value:void 0,children:eJ})]})});var P=t(40911),q=t(99056),D=t(57814),O=t(48665),A=t(71577),B=t(27015),F=t(59566),L=t(32983),I=t(57346),V=t(44442),U=t(99513),W=t(30119),$=t(39332),K=t(9837),Y=t(39156);let{Search:H}=F.default;function J(e){var l,t,a;let{editorValue:i,chartData:d,tableData:u,handleChange:s}=e,c=n.useMemo(()=>d?(0,o.jsx)("div",{className:"flex-1 overflow-auto p-3",style:{flexShrink:0,overflow:"hidden"},children:(0,o.jsx)(Y.Z,{chartsData:[d]})}):(0,o.jsx)("div",{}),[d]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,o.jsx)("div",{className:"flex-1",style:{flexShrink:0,overflow:"auto"},children:(0,o.jsx)(U.Z,{value:(null==i?void 0:i.sql)||"",language:"mysql",onChange:s,thoughts:(null==i?void 0:i.thoughts)||""})}),c]}),(0,o.jsx)("div",{className:"h-96 border-[var(--joy-palette-divider)] border-t border-solid overflow-auto",children:(null==u?void 0:null===(l=u.values)||void 0===l?void 0:l.length)>0?(0,o.jsxs)(r.Z,{"aria-label":"basic table",stickyHeader:!0,children:[(0,o.jsx)("thead",{children:(0,o.jsx)("tr",{children:null==u?void 0:null===(t=u.columns)||void 0===t?void 0:t.map((e,l)=>(0,o.jsx)("th",{children:e},e+l))})}),(0,o.jsx)("tbody",{children:null==u?void 0:null===(a=u.values)||void 0===a?void 0:a.map((e,l)=>{var t;return(0,o.jsx)("tr",{children:null===(t=Object.keys(e))||void 0===t?void 0:t.map(l=>(0,o.jsx)("td",{children:e[l]},l))},l)})})]}):(0,o.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,o.jsx)(L.Z,{})})})]})}var X=function(){var e,l,t,r,i;let[d,u]=n.useState([]),[s,c]=n.useState(""),[v,p]=n.useState(),[m,h]=n.useState(!0),[f,b]=n.useState(),[x,y]=n.useState(),[g,w]=n.useState(),[T,S]=n.useState(),[Z,j]=n.useState(),k=(0,$.useSearchParams)(),_=null==k?void 0:k.get("id"),N=null==k?void 0:k.get("scene"),{data:z,loading:R}=(0,a.Z)(async()=>await (0,W.Tk)("/v1/editor/sql/rounds",{con_uid:_}),{onSuccess:e=>{var l,t;let o=null==e?void 0:null===(l=e.data)||void 0===l?void 0:l[(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.length)-1];o&&p(null==o?void 0:o.round)}}),{run:C,loading:E}=(0,a.Z)(async()=>{var e,l;let t=null===(e=null==z?void 0:null===(l=z.data)||void 0===l?void 0:l.find(e=>e.round===v))||void 0===e?void 0:e.db_name;return await (0,W.PR)("/api/v1/editor/sql/run",{db_name:t,sql:null==g?void 0:g.sql})},{manual:!0,onSuccess:e=>{var l,t;S({columns:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.colunms,values:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.values})}}),{run:F,loading:L}=(0,a.Z)(async()=>{var e,l;let t=null===(e=null==z?void 0:null===(l=z.data)||void 0===l?void 0:l.find(e=>e.round===v))||void 0===e?void 0:e.db_name,o={db_name:t,sql:null==g?void 0:g.sql};return"chat_dashboard"===N&&(o.chart_type=null==g?void 0:g.showcase),await (0,W.PR)("/api/v1/editor/chart/run",o)},{manual:!0,ready:!!(null==g?void 0:g.sql),onSuccess:e=>{if(null==e?void 0:e.success){var l,t,o,n,a,r,i;S({columns:(null==e?void 0:null===(l=e.data)||void 0===l?void 0:null===(t=l.sql_data)||void 0===t?void 0:t.colunms)||[],values:(null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(n=o.sql_data)||void 0===n?void 0:n.values)||[]}),(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.chart_values)?b({type:null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.chart_type,values:null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.chart_values,title:null==g?void 0:g.title,description:null==g?void 0:g.thoughts}):b(void 0)}}}),{run:U,loading:Y}=(0,a.Z)(async()=>{var e,l,t,o,n;let a=null===(e=null==z?void 0:null===(l=z.data)||void 0===l?void 0:l.find(e=>e.round===v))||void 0===e?void 0:e.db_name;return await (0,W.PR)("/api/v1/sql/editor/submit",{conv_uid:_,db_name:a,conv_round:v,old_sql:null==x?void 0:x.sql,old_speak:null==x?void 0:x.thoughts,new_sql:null==g?void 0:g.sql,new_speak:(null===(t=null==g?void 0:null===(o=g.thoughts)||void 0===o?void 0:o.match(/^\n--(.*)\n\n$/))||void 0===t?void 0:null===(n=t[1])||void 0===n?void 0:n.trim())||(null==g?void 0:g.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&C()}}),{run:X,loading:G}=(0,a.Z)(async()=>{var e,l,t,o,n,a;let r=null===(e=null==z?void 0:null===(l=z.data)||void 0===l?void 0:l.find(e=>e.round===v))||void 0===e?void 0:e.db_name;return await (0,W.PR)("/api/v1/chart/editor/submit",{conv_uid:_,chart_title:null==g?void 0:g.title,db_name:r,old_sql:null==x?void 0:null===(t=x[Z])||void 0===t?void 0:t.sql,new_chart_type:null==g?void 0:g.showcase,new_sql:null==g?void 0:g.sql,new_comment:(null===(o=null==g?void 0:null===(n=g.thoughts)||void 0===n?void 0:n.match(/^\n--(.*)\n\n$/))||void 0===o?void 0:null===(a=o[1])||void 0===a?void 0:a.trim())||(null==g?void 0:g.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&F()}}),{data:Q}=(0,a.Z)(async()=>{var e,l;let t=null===(e=null==z?void 0:null===(l=z.data)||void 0===l?void 0:l.find(e=>e.round===v))||void 0===e?void 0:e.db_name;return await (0,W.Tk)("/v1/editor/db/tables",{db_name:t,page_index:1,page_size:200})},{ready:!!(null===(e=null==z?void 0:null===(l=z.data)||void 0===l?void 0:l.find(e=>e.round===v))||void 0===e?void 0:e.db_name),refreshDeps:[null===(t=null==z?void 0:null===(r=z.data)||void 0===r?void 0:r.find(e=>e.round===v))||void 0===t?void 0:t.db_name]}),{run:ee}=(0,a.Z)(async e=>await (0,W.Tk)("/v1/editor/sql",{con_uid:_,round:e}),{manual:!0,onSuccess:e=>{let l;try{if(Array.isArray(null==e?void 0:e.data))l=null==e?void 0:e.data,j("0");else if("string"==typeof(null==e?void 0:e.data)){let t=JSON.parse(null==e?void 0:e.data);l=t}else l=null==e?void 0:e.data}catch(e){console.log(e)}finally{y(l),Array.isArray(l)?w(null==l?void 0:l[Number(Z||0)]):w(l)}}}),el=n.useMemo(()=>{let e=(l,t)=>l.map(l=>{let n=l.title,a=n.indexOf(s),r=n.substring(0,a),i=n.slice(a+s.length),d=a>-1?(0,o.jsx)(M,{title:((null==l?void 0:l.comment)||(null==l?void 0:l.title))+((null==l?void 0:l.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,o.jsxs)("span",{children:[r,(0,o.jsx)("span",{className:"text-[#1677ff]",children:s}),i,(null==l?void 0:l.type)&&(0,o.jsx)(P.ZP,{gutterBottom:!0,level:"body3",className:"pl-0.5",style:{display:"inline"},children:"[".concat(null==l?void 0:l.type,"]")})]})}):(0,o.jsx)(M,{title:((null==l?void 0:l.comment)||(null==l?void 0:l.title))+((null==l?void 0:l.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,o.jsxs)("span",{children:[n,(null==l?void 0:l.type)&&(0,o.jsx)(P.ZP,{gutterBottom:!0,level:"body3",className:"pl-0.5",style:{display:"inline"},children:"[".concat(null==l?void 0:l.type,"]")})]})});if(l.children){let o=t?String(t)+"_"+l.key:l.key;return{title:n,showTitle:d,key:o,children:e(l.children,o)}}return{title:n,showTitle:d,key:l.key}});return(null==Q?void 0:Q.data)?(u([null==Q?void 0:Q.data.key]),e([null==Q?void 0:Q.data])):[]},[s,Q]),et=n.useMemo(()=>{let e=[],l=(t,o)=>{if(t&&!((null==t?void 0:t.length)<=0))for(let n=0;n<t.length;n++){let a=t[n],{key:r,title:i}=a;e.push({key:r,title:i,parentKey:o}),a.children&&l(a.children,r)}};return el&&l(el),e},[el]),eo=(e,l)=>{let t;for(let o=0;o<l.length;o++){let n=l[o];n.children&&(n.children.some(l=>l.key===e)?t=n.key:eo(e,n.children)&&(t=eo(e,n.children)))}return t};function en(e){let l;if(!e)return{sql:"",thoughts:""};let t=e&&e.match(/(--.*)\n([\s\S]*)/),o="";return t&&t.length>=3&&(o=t[1],l=t[2]),{sql:l,thoughts:o}}return n.useEffect(()=>{v&&ee(v)},[ee,v]),n.useEffect(()=>{x&&"chat_dashboard"===N&&Z&&F()},[Z,N,x,F]),n.useEffect(()=>{x&&"chat_dashboard"!==N&&C()},[N,x,C]),(0,o.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,o.jsx)(K.Z,{}),(0,o.jsxs)("div",{className:"relative flex flex-1 overflow-auto",children:[(0,o.jsxs)("div",{className:"text h-full border-[var(--joy-palette-divider)] border-r border-solid p-3 max-h-full overflow-auto",style:{width:"300px"},children:[(0,o.jsxs)("div",{className:"absolute right-4 top-2 z-10",children:[(0,o.jsx)(A.ZP,{className:"mr-2",type:"primary",loading:E||L,onClick:async()=>{"chat_dashboard"===N?F():C()},children:"Run"}),(0,o.jsx)(A.ZP,{loading:Y||G,onClick:async()=>{"chat_dashboard"===N?await X():await U()},children:"Save"})]}),(0,o.jsxs)("div",{className:"flex items-center py-3",children:[(0,o.jsx)(q.Z,{className:"h-4 min-w-[240px]",size:"sm",value:v,onChange:(e,l)=>{p(l)},children:null==z?void 0:null===(i=z.data)||void 0===i?void 0:i.map(e=>(0,o.jsx)(D.Z,{value:null==e?void 0:e.round,children:null==e?void 0:e.round_name},null==e?void 0:e.round))}),(0,o.jsx)(B.Z,{className:"ml-2"})]}),(0,o.jsx)(H,{style:{marginBottom:8},placeholder:"Search",onChange:e=>{let{value:l}=e.target;if(null==Q?void 0:Q.data){if(l){let e=et.map(e=>e.title.indexOf(l)>-1?eo(e.key,el):null).filter((e,l,t)=>e&&t.indexOf(e)===l);u(e)}else u([]);c(l),h(!0)}}}),el&&el.length>0&&(0,o.jsx)(I.Z,{onExpand:e=>{u(e),h(!1)},expandedKeys:d,autoExpandParent:m,treeData:el,fieldNames:{title:"showTitle"}})]}),(0,o.jsx)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:Array.isArray(x)?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(O.Z,{className:"h-full",sx:{".ant-tabs-content, .ant-tabs-tabpane-active":{height:"100%"},"& .ant-tabs-card.ant-tabs-top >.ant-tabs-nav .ant-tabs-tab, & .ant-tabs-card.ant-tabs-top >div>.ant-tabs-nav .ant-tabs-tab":{borderRadius:"0"}},children:(0,o.jsx)(V.Z,{className:"h-full dark:text-white px-2",activeKey:Z,onChange:e=>{j(e),w(null==x?void 0:x[Number(e)])},items:null==x?void 0:x.map((e,l)=>({key:l+"",label:null==e?void 0:e.title,children:(0,o.jsx)("div",{className:"flex flex-col h-full",children:(0,o.jsx)(J,{editorValue:e,handleChange:e=>{let{sql:l,thoughts:t}=en(e);w(e=>Object.assign({},e,{sql:l,thoughts:t}))},tableData:T,chartData:f})})}))})})}):(0,o.jsx)(J,{editorValue:x,handleChange:e=>{let{sql:l,thoughts:t}=en(e);w(e=>Object.assign({},e,{sql:l,thoughts:t}))},tableData:T,chartData:void 0})})]})]})}}}]);