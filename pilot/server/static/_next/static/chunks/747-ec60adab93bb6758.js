"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{78543:function(e,t,l){l.d(t,{Z:function(){return w}});var s=l(85893),a=l(67294),n=l(12069),i=l(3363),c=l(67421),r=l(50489),o=l(75081),d=l(39479),m=l(59566),u=l(71577);function h(e){let{t}=(0,c.$G)(),{handleAddKnowledge:l}=e,[n,i]=(0,a.useState)(!1),h=async e=>{let{knowledgeName:t,owner:s,description:a}=e;i(!0);let[n,c,o]=await (0,r.Vx)((0,r.U6)({name:t,vector_type:"Chroma",owner:s,desc:a}));i(!1),(null==o?void 0:o.success)&&l(t)};return(0,s.jsx)(o.Z,{spinning:n,children:(0,s.jsxs)(d.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:h,children:[(0,s.jsx)(d.Z.Item,{label:t("Knowledge_Space_Name"),name:"knowledgeName",rules:[{required:!0,message:t("Please_input_the_name")},()=>({validator:(e,l)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(l)?Promise.reject(Error(t("the_name_can_only_contain"))):Promise.resolve()})],children:(0,s.jsx)(m.default,{className:"mb-5 h-12",placeholder:t("Please_input_the_name")})}),(0,s.jsx)(d.Z.Item,{label:t("Owner"),name:"owner",rules:[{required:!0,message:t("Please_input_the_owner")}],children:(0,s.jsx)(m.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_owner")})}),(0,s.jsx)(d.Z.Item,{label:t("Description"),name:"description",rules:[{required:!0,message:t("Please_input_the_description")}],children:(0,s.jsx)(m.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_description")})}),(0,s.jsx)(d.Z.Item,{children:(0,s.jsx)(u.ZP,{type:"primary",htmlType:"submit",children:t("Next")})})]})})}var x=l(31365),p=l(2453),_=l(85813),j=l(72269),f=l(92039),g=l(64082);let b={ChooseType:1,AddDataSourceForm:2},{Dragger:Z}=x.default,{TextArea:y}=m.default;function N(e){let{handleChooseType:t,documentType:l,step:n,handleBackBtn:i,knowledgeName:h,fetchDocuments:N,setIsAddShow:w}=e,{t:k}=(0,c.$G)(),[T]=d.Z.useForm(),[S,P]=(0,a.useState)(!1),v=async e=>{var t;let s;let{synchChecked:a,documentName:n,textSource:i,originFileObj:c,text:o,webPageUrl:d}=e;switch(P(!0),l){case"webPage":s=await (0,r.Vx)((0,r.H_)(h,{doc_name:n,content:d,doc_type:"URL"}));break;case"file":let m=new FormData;m.append("doc_name",n||c.file.name),m.append("doc_file",c.file),m.append("doc_type","DOCUMENT"),m.append("space_name",h),s=await (0,r.Vx)((0,r.iG)(h,m));break;default:s=await (0,r.Vx)((0,r.H_)(h,{doc_name:n,source:i,content:o,doc_type:"TEXT"}))}a&&(null==C||C(h,null==s?void 0:s[1])),P(!1),(null===(t=s[2])||void 0===t?void 0:t.success)&&(null==w||w(!1),null==N||N())},C=async(e,t)=>{await (0,r.Vx)((0,r.Hx)(e,{doc_ids:[t]}))},F=()=>{let e=T.getFieldsValue().originFileObj;return!!e&&(p.ZP.warning(k("Limit_Upload_File_Count_Tips")),x.default.LIST_IGNORE)},I=e=>{let{file:t,fileList:l}=e;T.getFieldsValue().documentName||T.setFieldValue("documentName",t.name),0===l.length&&T.setFieldValue("originFileObj",null)},D=[{type:"text",title:k("Text"),subTitle:k("Fill your raw text"),iconType:"TEXT"},{type:"webPage",title:k("URL"),subTitle:k("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"file",title:k("Document"),subTitle:k("Upload_a_document"),iconType:"DOCUMENT"}],E=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z.Item,{label:"".concat(k("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:k("Please_input_the_text_source")}],children:(0,s.jsx)(m.default,{className:"mb-5  h-12",placeholder:k("Please_input_the_text_source")})}),(0,s.jsx)(d.Z.Item,{label:"".concat(k("Text"),":"),name:"text",rules:[{required:!0,message:k("Please_input_the_description")}],children:(0,s.jsx)(y,{rows:4,maxLength:6})})]}),A=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(d.Z.Item,{label:"".concat(k("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:k("Please_input_the_owner")}],children:(0,s.jsx)(m.default,{className:"mb-5  h-12",placeholder:k("Please_input_the_Web_Page_URL")})})}),V=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(d.Z.Item,{name:"originFileObj",rules:[{required:!0,message:k("Please_input_the_owner")}],children:(0,s.jsxs)(Z,{onChange:I,beforeUpload:F,multiple:!1,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(g.Z,{})}),(0,s.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:k("Select_or_Drop_file")}),(0,s.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})})});return n===b.ChooseType?(0,s.jsx)(s.Fragment,{children:D.map((e,l)=>(0,s.jsxs)(_.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{t(e)},children:[(0,s.jsxs)("div",{className:"font-semibold",children:[(0,f._)(e.iconType)," ",e.title]}),(0,s.jsx)("div",{children:e.subTitle})]},l))}):(0,s.jsx)(o.Z,{spinning:S,children:(0,s.jsxs)(d.Z,{form:T,size:"large",className:"mt-4",layout:"vertical",name:"basic",autoComplete:"off",onFinish:v,children:[(0,s.jsx)(d.Z.Item,{label:"".concat(k("Name"),":"),name:"documentName",rules:[{required:!0,message:k("Please_input_the_name")}],children:(0,s.jsx)(m.default,{className:"mb-5 h-12",placeholder:k("Please_input_the_name")})}),(()=>{switch(l){case"webPage":return A();case"file":return V();default:return E()}})(),(0,s.jsx)(d.Z.Item,{label:"".concat(k("Synch"),":"),name:"synchChecked",initialValue:!0,children:(0,s.jsx)(j.Z,{className:"bg-slate-400",defaultChecked:!0})}),(0,s.jsxs)(d.Z.Item,{children:[(0,s.jsx)(u.ZP,{onClick:i,className:"mr-4",children:"".concat(k("Back"))}),(0,s.jsx)(u.ZP,{type:"primary",htmlType:"submit",children:k("Finish")})]})]})})}function w(e){let{setIsAddShow:t,isAddShow:l,type:r,knowLedge:o,fetchDocuments:d,fetchKnowledge:m,syncDocuments:u}=e,{t:x}=(0,c.$G)(),p=[{title:x("Knowledge_Space_Config")},{title:x("Choose_a_Datasource_type")},{title:x("Setup_the_Datasource")}],_=[{title:x("Choose_a_Datasource_type")},{title:x("Setup_the_Datasource")}],[j,f]=(0,a.useState)(""),[g,b]=(0,a.useState)(0),[Z,y]=(0,a.useState)(),w=async e=>{b(1),null==m||m(),y(e)},k=e=>{f(e.type),b("knowledge"===r?2:1)},T=()=>{b("knowledge"===r?1:0)};return(0,s.jsxs)(n.default,{title:"knowledge"===r?"Add Knowledge":"Add Datasource",centered:!0,open:l,destroyOnClose:!0,onCancel:()=>{t(!1)},width:1e3,afterClose:()=>{b(0)},footer:null,children:[(0,s.jsx)(i.Z,{current:g,items:"knowledge"===r?p:_}),(()=>{let t="document"===r?g+1:g;return 0===t?(0,s.jsx)(h,{handleAddKnowledge:w}):(0,s.jsx)(N,{fetchDocuments:d,knowledgeName:(null==o?void 0:o.name)||Z,step:t,documentType:j,handleChooseType:k,handleBackBtn:T,setIsAddShow:e.setIsAddShow})})()]})}},92039:function(e,t,l){l.d(t,{Z:function(){return O},_:function(){return q}});var s=l(85893),a=l(67294),n=l(12069),i=l(83062),c=l(66309),r=l(85813),o=l(32983),d=l(71577),m=l(42075),u=l(96074),h=l(75081),x=l(27595),p=l(27329),_=l(68346),j=l(21640),f=l(31326),g=l(88008),b=l(27704),Z=l(24969),y=l(18754),N=l(50489),w=l(30381),k=l.n(w),T=l(78543),S=l(59566),P=l(71230),v=l(15746),C=l(39479),F=l(44442),I=l(67421),D=l(31545),E=l(6321);let{TextArea:A}=S.default;function V(e){let{knowledge:t,argumentsShow:l,setArgumentsShow:i}=e,{t:c}=(0,I.$G)(),[r,o]=(0,a.useState)(),[m,u]=(0,a.useState)(!1),x=async()=>{let[e,l]=await (0,N.Vx)((0,N.Tu)(t.name));o(l)};(0,a.useEffect)(()=>{x()},[]);let p=[{key:"Embedding",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(D.Z,{}),c("Embedding")]}),children:(0,s.jsxs)(P.Z,{gutter:24,children:[(0,s.jsx)(v.Z,{span:12,offset:0,children:(0,s.jsx)(C.Z.Item,{tooltip:c("the_top_k_vectors"),rules:[{required:!0}],label:c("topk"),name:["embedding","topk"],children:(0,s.jsx)(S.default,{className:"mb-5 h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("Set_a_threshold_score"),rules:[{required:!0}],label:c("recall_score"),name:["embedding","recall_score"],children:(0,s.jsx)(S.default,{className:"mb-5  h-12",placeholder:c("Please_input_the_owner")})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("Recall_Type"),rules:[{required:!0}],label:c("recall_type"),name:["embedding","recall_type"],children:(0,s.jsx)(S.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("A_model_used"),rules:[{required:!0}],label:c("model"),name:["embedding","model"],children:(0,s.jsx)(S.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("The_size_of_the_data_chunks"),rules:[{required:!0}],label:c("chunk_size"),name:["embedding","chunk_size"],children:(0,s.jsx)(S.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("The_amount_of_overlap"),rules:[{required:!0}],label:c("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,s.jsx)(S.default,{className:"mb-5  h-12",placeholder:c("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(E.Z,{}),c("Embedding")]}),children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z.Item,{tooltip:c("A_contextual_parameter"),label:c("scene"),name:["prompt","scene"],children:(0,s.jsx)(A,{rows:4,className:"mb-2"})}),(0,s.jsx)(C.Z.Item,{tooltip:c("structure_or_format"),label:c("template"),name:["prompt","template"],children:(0,s.jsx)(A,{rows:7,className:"mb-2"})}),(0,s.jsx)(C.Z.Item,{tooltip:c("The_maximum_number_of_tokens"),label:c("max_token"),name:["prompt","max_token"],children:(0,s.jsx)(S.default,{className:"mb-2"})})]})}],_=async e=>{u(!0);let[l,s,a]=await (0,N.Vx)((0,N.iH)(t.name,{argument:JSON.stringify(e)}));u(!1),(null==a?void 0:a.success)&&i(!1)};return(0,s.jsx)(n.default,{width:850,open:l,onCancel:()=>{i(!1)},footer:null,children:(0,s.jsx)(h.Z,{spinning:m,children:(0,s.jsxs)(C.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...r},autoComplete:"off",onFinish:_,children:[(0,s.jsx)(F.Z,{items:p}),(0,s.jsxs)("div",{className:"mt-3 mb-3",children:[(0,s.jsx)(d.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:c("Submit")}),(0,s.jsx)(d.ZP,{onClick:()=>{i(!1)},children:c("close")})]})]})})})}var z=l(11163);let{confirm:U}=n.default,q=e=>"TEXT"===e?(0,s.jsx)(x.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===e?(0,s.jsx)(p.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,s.jsx)(_.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"});function O(e){let{t}=(0,I.$G)(),l=(0,z.useRouter)(),{knowledge:n,setDocumentCount:x}=e,[p,_]=(0,a.useState)(!1),[w,S]=(0,a.useState)([]),[P,v]=(0,a.useState)(!1),[C,F]=(0,a.useState)(!1),D=e=>{U({title:t("Tips"),icon:(0,s.jsx)(j.Z,{}),content:"".concat(t("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await O(e)}})};async function E(){_(!0);let[e,t]=await (0,N.Vx)((0,N._Q)(null==n?void 0:n.name,{page:1,page_size:20}));S(null==t?void 0:t.data),x(String(null==t?void 0:t.total)),_(!1)}let A=async(e,t)=>{await (0,N.Vx)((0,N.Hx)(e,{doc_ids:[t]}))},O=async e=>{await (0,N.Vx)((0,N.n3)(null==n?void 0:n.name,{doc_name:e.doc_name})),E()},L=()=>{v(!0)},G=(e,t)=>{let l;switch(e){case"TODO":l="gold";break;case"RUNNING":l="#2db7f5";break;case"FINISHED":l="#87d068";break;default:l="f50"}return(0,s.jsx)(i.Z,{title:t,children:(0,s.jsx)(c.Z,{color:l,children:e})})};return(0,a.useEffect)(()=>{E()},[n]),(0,s.jsxs)("div",{className:"collapse-container pt-2 px-4",children:[(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(d.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,s.jsx)(Z.Z,{}),onClick:L,children:t("Add_Datasource")}),(0,s.jsx)(d.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,s.jsx)(y.Z,{}),onClick:()=>{F(!0)},children:"Arguments"})]}),(0,s.jsx)(u.Z,{}),(0,s.jsx)(h.Z,{spinning:p,children:w.length>0?(0,s.jsx)("div",{className:"max-h-96 mt-3 grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-5 overflow-auto",children:w.map(e=>(0,s.jsxs)(r.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full",title:(0,s.jsx)(i.Z,{title:e.doc_name,children:(0,s.jsxs)("div",{className:"truncate ",children:[q(e.doc_type),(0,s.jsx)("span",{children:e.doc_name})]})}),extra:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(i.Z,{title:"detail",children:(0,s.jsx)(f.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{l.push("/knowledge/".concat(n.name,"/").concat(e.id))}})}),(0,s.jsx)(i.Z,{title:"Sync",children:(0,s.jsx)(g.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{A(n.name,e.id)}})}),(0,s.jsx)(i.Z,{title:"Delete",children:(0,s.jsx)(b.Z,{className:"text-[#ff1b2e] !text-lg",onClick:()=>{D(e)}})})]}),children:[(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Size"),":"]}),(0,s.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Last_Synch"),":"]}),(0,s.jsx)("p",{children:k()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,s.jsx)("p",{className:"mt-2 mb-2",children:G(e.status,e.result)})]},e.id))}):(0,s.jsx)(o.Z,{image:o.Z.PRESENTED_IMAGE_DEFAULT,children:(0,s.jsx)(d.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,s.jsx)(Z.Z,{}),onClick:L,children:"Create Now"})})}),(0,s.jsx)(T.Z,{syncDocuments:A,fetchDocuments:E,setIsAddShow:v,isAddShow:P,type:"document",setDocuments:S,knowLedge:n}),(0,s.jsx)(V,{knowledge:n,argumentsShow:C,setArgumentsShow:F})]})}}}]);