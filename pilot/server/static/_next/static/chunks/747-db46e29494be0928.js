"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{78543:function(e,t,l){l.d(t,{Z:function(){return Z}});var s=l(85893),a=l(67294),n=l(12069),i=l(3363),c=l(67421),r=l(50489),o=l(39479),d=l(59566),m=l(71577);function u(e){let{t}=(0,c.$G)(),{handleAddKnowledge:l}=e,a=async e=>{let{knowledgeName:t,owner:s,description:a}=e,[n,i,c]=await (0,r.Vx)((0,r.U6)({name:t,vector_type:"Chroma",owner:s,desc:a}));(null==c?void 0:c.success)&&l()};return(0,s.jsxs)(o.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:a,children:[(0,s.jsx)(o.Z.Item,{label:t("Knowledge_Space_Name"),name:"knowledgeName",rules:[{required:!0,message:t("Please_input_the_name")},()=>({validator:(e,l)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(l)?Promise.reject(Error(t("the_name_can_only_contain"))):Promise.resolve()})],children:(0,s.jsx)(d.default,{className:"mb-5 h-12",placeholder:t("Please_input_the_name")})}),(0,s.jsx)(o.Z.Item,{label:t("Owner"),name:"owner",rules:[{required:!0,message:t("Please_input_the_owner")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_owner")})}),(0,s.jsx)(o.Z.Item,{label:t("Description"),name:"description",rules:[{required:!0,message:t("Please_input_the_description")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_description")})}),(0,s.jsx)(o.Z.Item,{children:(0,s.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:t("Next")})})]})}var x=l(31365),h=l(85813),p=l(72269),_=l(92039),j=l(64082);let f={ChooseType:1,AddDataSourceForm:2},{Dragger:b}=x.default;function g(e){let{handleChooseType:t,documentType:l,step:a,handleBackBtn:n,knowledgeName:i,syncDocuments:u,fetchDocuments:x,setIsAddShow:g}=e,{t:Z}=(0,c.$G)(),{TextArea:y}=d.default,N=async e=>{var t;let s;let{synchChecked:a,documentName:n,textSource:c,originFileObj:o,text:d,webPageUrl:m}=e;switch(l){case"webPage":s=await (0,r.Vx)((0,r.H_)(i,{doc_name:n,content:m,doc_type:"URL"}));break;case"file":let h=new FormData;h.append("doc_name",o.file.name),h.append("doc_file",o.file),h.append("doc_type","DOCUMENT"),s=await (0,r.Vx)((0,r.iG)(i,h));break;default:s=await (0,r.Vx)((0,r.H_)(i,{doc_name:n,source:c,content:d,doc_type:"TEXT"}))}a&&(null==u||u(i,null==s?void 0:s[1])),(null===(t=s[2])||void 0===t?void 0:t.success)&&(null==g||g(!1),null==x||x())},w=e=>!!["application/pdf","application/vnd.ms-powerpoint","application/vnd.ms-excel","application/msword","text/plain","text/markdown"].includes(e.type),k=[{type:"text",title:Z("Text"),subTitle:Z("Fill your raw text"),iconType:"TEXT"},{type:"webPage",title:Z("URL"),subTitle:Z("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"file",title:Z("Document"),subTitle:Z("Upload_a_document"),iconType:"DOCUMENT"}],v=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Item,{label:"".concat(Z("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:Z("Please_input_the_text_source")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:Z("Please_input_the_text_source")})}),(0,s.jsx)(o.Z.Item,{label:"".concat(Z("Text"),":"),name:"text",rules:[{required:!0,message:Z("Please_input_the_description")}],children:(0,s.jsx)(y,{rows:4,maxLength:6})})]}),T=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(o.Z.Item,{label:"".concat(Z("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:Z("Please_input_the_owner")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:Z("Please_input_the_Web_Page_URL")})})}),P=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(o.Z.Item,{name:"originFileObj",rules:[{required:!0,message:Z("Please_input_the_owner")},()=>({validator:(e,t)=>w(t.file)?Promise.resolve():Promise.reject(Error(Z("File_type_Invalid")))})],children:(0,s.jsxs)(b,{accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(j.Z,{})}),(0,s.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:Z("Select_or_Drop_file")}),(0,s.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})})});return a===f.ChooseType?(0,s.jsx)(s.Fragment,{children:k.map((e,l)=>(0,s.jsxs)(h.Z,{className:"mt-4 mb-4",onClick:()=>{t(e)},children:[(0,s.jsxs)("div",{className:"font-semibold",children:[(0,_._)(e.iconType)," ",e.title]}),(0,s.jsx)("div",{children:e.subTitle})]},l))}):(0,s.jsxs)(o.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:N,children:[(0,s.jsx)(o.Z.Item,{label:"".concat(Z("Name"),":"),name:"documentName",rules:[{required:!0,message:Z("Please_input_the_name")}],children:(0,s.jsx)(d.default,{className:"mb-5 h-12",placeholder:Z("Please_input_the_name")})}),(()=>{switch(l){case"webPage":return T();case"file":return P();default:return v()}})(),(0,s.jsx)(o.Z.Item,{label:"".concat(Z("Synch"),":"),name:"synchChecked",children:(0,s.jsx)(p.Z,{className:"bg-slate-400"})}),(0,s.jsxs)(o.Z.Item,{children:[(0,s.jsx)(m.ZP,{onClick:n,className:"mr-4",children:"".concat(Z("Back"))}),(0,s.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:Z("Finish")})]})]})}function Z(e){let{setIsAddShow:t,isAddShow:l,type:r,knowLedge:o,fetchDocuments:d,fetchKnowledge:m,syncDocuments:x}=e,{t:h}=(0,c.$G)(),p=[{title:h("Knowledge_Space_Config")},{title:h("Choose_a_Datasource_type")},{title:h("Setup_the_Datasource")}],_=[{title:h("Choose_a_Datasource_type")},{title:h("Setup_the_Datasource")}],[j,f]=(0,a.useState)(""),[b,Z]=(0,a.useState)(0),y=async()=>{Z(1),null==m||m()},N=e=>{f(e.type),Z("knowledge"===r?2:1)},w=()=>{Z("knowledge"===r?1:0)};return(0,s.jsxs)(n.default,{title:"knowledge"===r?"Add Knowledge":"Add Datasource",centered:!0,open:l,destroyOnClose:!0,onCancel:()=>{t(!1)},width:1e3,afterClose:()=>{Z(0)},footer:null,children:[(0,s.jsx)(i.Z,{current:b,items:"knowledge"===r?p:_}),(()=>{let t="document"===r?b+1:b;return 0===t?(0,s.jsx)(u,{handleAddKnowledge:y}):(0,s.jsx)(g,{fetchDocuments:d,knowledgeName:null==o?void 0:o.name,step:t,documentType:j,handleChooseType:N,handleBackBtn:w,syncDocuments:x,setIsAddShow:e.setIsAddShow})})()]})}},92039:function(e,t,l){l.d(t,{Z:function(){return O},_:function(){return V}});var s=l(85893),a=l(67294),n=l(12069),i=l(83062),c=l(66309),r=l(85813),o=l(32983),d=l(71577),m=l(42075),u=l(96074),x=l(75081),h=l(27595),p=l(27329),_=l(68346),j=l(21640),f=l(31326),b=l(88008),g=l(27704),Z=l(24969),y=l(18754),N=l(50489),w=l(30381),k=l.n(w),v=l(78543),T=l(59566),P=l(71230),S=l(15746),C=l(39479),D=l(44442),I=l(67421),E=l(31545),F=l(6321);let{TextArea:A}=T.default;function z(e){let{knowledge:t,argumentsShow:l,setArgumentsShow:i}=e,{t:c}=(0,I.$G)(),[r,o]=(0,a.useState)(),m=async()=>{let[e,l]=await (0,N.Vx)((0,N.Tu)(t.name));o(l)};(0,a.useEffect)(()=>{m()},[]);let u=[{key:"Embedding",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(E.Z,{}),c("Embedding")]}),children:(0,s.jsxs)(P.Z,{gutter:24,children:[(0,s.jsx)(S.Z,{span:12,offset:0,children:(0,s.jsx)(C.Z.Item,{tooltip:c("the_top_k_vectors"),rules:[{required:!0}],label:c("topk"),name:["embedding","topk"],children:(0,s.jsx)(T.default,{className:"mb-5 h-12"})})}),(0,s.jsx)(S.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("Set_a_threshold_score"),rules:[{required:!0}],label:c("recall_score"),name:["embedding","recall_score"],children:(0,s.jsx)(T.default,{className:"mb-5  h-12",placeholder:c("Please_input_the_owner")})})}),(0,s.jsx)(S.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("Recall_Type"),rules:[{required:!0}],label:c("recall_type"),name:["embedding","recall_type"],children:(0,s.jsx)(T.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(S.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("A_model_used"),rules:[{required:!0}],label:c("model"),name:["embedding","model"],children:(0,s.jsx)(T.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(S.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("The_size_of_the_data_chunks"),rules:[{required:!0}],label:c("chunk_size"),name:["embedding","chunk_size"],children:(0,s.jsx)(T.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(S.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:c("The_amount_of_overlap"),rules:[{required:!0}],label:c("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,s.jsx)(T.default,{className:"mb-5  h-12",placeholder:c("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(F.Z,{}),c("Embedding")]}),children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z.Item,{tooltip:c("A_contextual_parameter"),label:c("scene"),name:["prompt","scene"],children:(0,s.jsx)(A,{rows:4,className:"mb-2"})}),(0,s.jsx)(C.Z.Item,{tooltip:c("structure_or_format"),label:c("template"),name:["prompt","template"],children:(0,s.jsx)(A,{rows:7,className:"mb-2"})}),(0,s.jsx)(C.Z.Item,{tooltip:c("The_maximum_number_of_tokens"),label:c("max_token"),name:["prompt","max_token"],children:(0,s.jsx)(T.default,{className:"mb-2"})})]})}],x=async e=>{let[l,s,a]=await (0,N.Vx)((0,N.iH)(t.name,{argument:JSON.stringify(e)}));(null==a?void 0:a.success)&&i(!1)};return(0,s.jsx)(n.default,{width:850,open:l,onCancel:()=>{i(!1)},footer:null,children:(0,s.jsxs)(C.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...r},autoComplete:"off",onFinish:x,children:[(0,s.jsx)(D.Z,{items:u}),(0,s.jsxs)("div",{className:"mt-3 mb-3",children:[(0,s.jsx)(d.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:c("Submit")}),(0,s.jsx)(d.ZP,{onClick:()=>{i(!1)},children:c("close")})]})]})})}var q=l(11163);let{confirm:U}=n.default,V=e=>"TEXT"===e?(0,s.jsx)(h.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===e?(0,s.jsx)(p.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,s.jsx)(_.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"});function O(e){let{t}=(0,I.$G)(),l=(0,q.useRouter)(),{knowledge:n,setDocumentCount:h}=e,[p,_]=(0,a.useState)(!1),[w,T]=(0,a.useState)([]),[P,S]=(0,a.useState)(!1),[C,D]=(0,a.useState)(!1),E=e=>{U({title:t("Tips"),icon:(0,s.jsx)(j.Z,{}),content:"".concat(t("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await O(e)}})};async function F(){_(!0);let[e,t]=await (0,N.Vx)((0,N._Q)(null==n?void 0:n.name,{page:1,page_size:20}));T(null==t?void 0:t.data),h(String(null==t?void 0:t.total)),_(!1)}let A=async(e,t)=>{await (0,N.Vx)((0,N.Hx)(e,{doc_ids:[t]}))},O=async e=>{await (0,N.Vx)((0,N.n3)(null==n?void 0:n.name,{doc_name:e.doc_name})),F()},G=()=>{S(!0)},L=(e,t)=>{let l;switch(e){case"TODO":l="gold";break;case"RUNNING":l="#2db7f5";break;case"FINISHED":l="#87d068";break;default:l="f50"}return(0,s.jsx)(i.Z,{title:t,children:(0,s.jsx)(c.Z,{color:l,children:e})})};return(0,a.useEffect)(()=>{F()},[n]),(0,s.jsxs)("div",{className:"collapse-container pt-2 px-4",children:[(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(d.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,s.jsx)(Z.Z,{}),onClick:G,children:t("Add_Datasource")}),(0,s.jsx)(d.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,s.jsx)(y.Z,{}),onClick:()=>{D(!0)},children:"Arguments"})]}),(0,s.jsx)(u.Z,{}),(0,s.jsx)(x.Z,{spinning:p,children:w.length>0?(0,s.jsx)("div",{className:"max-h-96 mt-3 grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-5 overflow-auto",children:w.map(e=>(0,s.jsxs)(r.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full",title:(0,s.jsx)(i.Z,{title:e.doc_name,children:(0,s.jsxs)("div",{className:"truncate ",children:[V(e.doc_type),(0,s.jsx)("span",{children:e.doc_name})]})}),extra:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(i.Z,{title:"detail",children:(0,s.jsx)(f.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{l.push("/knowledge/".concat(n.name,"/").concat(e.id))}})}),(0,s.jsx)(i.Z,{title:"Sync",children:(0,s.jsx)(b.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{A(n.name,e.id)}})}),(0,s.jsx)(i.Z,{title:"Delete",children:(0,s.jsx)(g.Z,{className:"text-[#ff1b2e] !text-lg",onClick:()=>{E(e)}})})]}),children:[(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Size"),":"]}),(0,s.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Last_Synch"),":"]}),(0,s.jsx)("p",{children:k()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,s.jsx)("p",{className:"mt-2 mb-2",children:L(e.status,e.result)})]},e.id))}):(0,s.jsx)(o.Z,{image:o.Z.PRESENTED_IMAGE_DEFAULT,children:(0,s.jsx)(d.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,s.jsx)(Z.Z,{}),onClick:G,children:"Create Now"})})}),(0,s.jsx)(v.Z,{syncDocuments:A,fetchDocuments:F,setIsAddShow:S,isAddShow:P,type:"document",setDocuments:T,knowLedge:n}),(0,s.jsx)(z,{knowledge:n,argumentsShow:C,setArgumentsShow:D})]})}}}]);