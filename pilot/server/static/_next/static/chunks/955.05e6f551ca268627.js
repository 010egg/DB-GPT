(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[955],{13135:function(e,t,l){"use strict";l.d(t,{_z:function(){return O},ZP:function(){return S},aG:function(){return P}});var n=l(85893),a=l(41118),r=l(30208),s=l(40911),i=l(58234);function c(e){let{chart:t}=e;return(0,n.jsx)("div",{className:"flex-1 min-w-0",children:(0,n.jsx)(a.Z,{className:"h-full",sx:{background:"transparent"},children:(0,n.jsxs)(r.Z,{className:"h-full",children:[(0,n.jsx)(s.ZP,{gutterBottom:!0,component:"div",children:t.chart_name}),(0,n.jsx)(s.ZP,{gutterBottom:!0,level:"body3",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(i.k,{style:{height:"100%"},options:{autoFit:!0,type:"interval",data:t.values,encode:{x:"name",y:"value",color:"type"},axis:{x:{labelAutoRotate:!1}}}})})]})})})}function o(e){let{chart:t}=e;return(0,n.jsx)("div",{className:"flex-1 min-w-0",children:(0,n.jsx)(a.Z,{className:"h-full",sx:{background:"transparent"},children:(0,n.jsxs)(r.Z,{className:"h-full",children:[(0,n.jsx)(s.ZP,{gutterBottom:!0,component:"div",children:t.chart_name}),(0,n.jsx)(s.ZP,{gutterBottom:!0,level:"body3",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(i.k,{style:{height:"100%"},options:{autoFit:!0,type:"view",data:t.values,children:[{type:"line",encode:{x:"name",y:"value",color:"type",shape:"smooth"}},{type:"area",encode:{x:"name",y:"value",color:"type",shape:"smooth"},legend:!1,style:{fillOpacity:.15}}],axis:{x:{labelAutoRotate:!1}}}})})]})})})}var d=l(61685),u=l(96486);function h(e){var t,l;let{chart:i}=e,c=(0,u.groupBy)(i.values,"type");return(0,n.jsx)("div",{className:"flex-1 min-w-0",children:(0,n.jsx)(a.Z,{className:"h-full overflow-auto",sx:{background:"transparent"},children:(0,n.jsxs)(r.Z,{className:"h-full",children:[(0,n.jsx)(s.ZP,{gutterBottom:!0,component:"div",children:i.chart_name}),(0,n.jsx)(s.ZP,{gutterBottom:!0,level:"body3",children:i.chart_desc}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(d.Z,{"aria-label":"basic table",stripe:"odd",hoverRow:!0,borderAxis:"bothBetween",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:Object.keys(c).map(e=>(0,n.jsx)("th",{children:e},e))})}),(0,n.jsx)("tbody",{children:null===(t=Object.values(c))||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.map((e,t)=>{var l;return(0,n.jsx)("tr",{children:null===(l=Object.keys(c))||void 0===l?void 0:l.map(e=>{var l;return(0,n.jsx)("td",{children:(null==c?void 0:null===(l=c[e])||void 0===l?void 0:l[t].value)||""},e)})},t)})})]})})]})})})}var m=l(67294),x=l(51009),p=l(71230),f=l(15746),v=l(83062),y=l(32983),j=l(80882),g=l(58989),_=l(5165);let b=e=>{let{charts:t,scopeOfCharts:l,ruleConfig:n}=e,a={};if(null==t||t.forEach(e=>{if(e.chartKnowledge.toSpec){let t=e.chartKnowledge.toSpec;e.chartKnowledge.toSpec=(e,l)=>({...t(e,l),dataProps:l})}else e.chartKnowledge.toSpec=(e,t)=>({dataProps:t});a[e.chartType]=e.chartKnowledge}),(null==l?void 0:l.exclude)&&l.exclude.forEach(e=>{Object.keys(a).includes(e)&&delete a[e]}),null==l?void 0:l.include){let e=l.include;Object.keys(a).forEach(t=>{e.includes(t)||delete a[t]})}let r={...l,custom:a},s={...n},i=new _.w({ckbCfg:r,ruleCfg:s});return i},w=e=>{var t;let{data:l,dataMetaMap:n,myChartAdvisor:a}=e,r=n?Object.keys(n).map(e=>({name:e,...n[e]})):null,s=null==a?void 0:a.adviseWithLog({data:l,dataProps:r});return null!==(t=null==s?void 0:s.advices)&&void 0!==t?t:[]};function Z(e,t){return t.every(t=>e.includes(t))}function N(e,t){let l=t.find(t=>t.name===e);return(null==l?void 0:l.recommendation)==="date"?t=>new Date(t[e]):e}let C=[{chartType:"multi_line_chart",chartKnowledge:{id:"multi_line_chart",name:"multi_line_chart",alias:["multi_line_chart"],family:["LineCharts"],def:"multi_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Trend"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:1,fieldConditions:["Time","Ordinal"]},{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:0,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{let l=t.find(e=>{var t;return t=e.levelOfMeasurements,["Time","Ordinal"].some(e=>t.includes(e))}),n=t.filter(e=>Z(e.levelOfMeasurements,["Interval"])),a=t.find(e=>Z(e.levelOfMeasurements,["Nominal"]));if(!l||!n)return null;let r={type:"view",autoFit:!0,data:e,children:[]};return n.forEach(e=>{let n={type:"line",encode:{x:N(l.name,t),y:e.name}};a&&(n.encode.color=a.name),r.children.push(n)}),r}},chineseName:"折线图"},{chartType:"multi_measure_column_chart",chartKnowledge:{id:"multi_measure_column_chart",name:"multi_measure_column_chart",alias:["multi_measure_column_chart"],family:["ColumnCharts"],def:"multi_measure_column_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{let l=null==t?void 0:t.filter(e=>Z(e.levelOfMeasurements,["Interval"])),n=null==t?void 0:t.find(e=>Z(e.levelOfMeasurements,["Nominal"]));if(!n||!l)return null;let a={type:"view",data:e,children:[]};return null==l||l.forEach(e=>{let t={type:"interval",encode:{x:n.name,y:e.name,color:()=>e.name,series:()=>e.name}};a.children.push(t)}),a}catch(e){return console.log(e),null}}},chineseName:"折线图"},{chartType:"multi_measure_line_chart",chartKnowledge:{id:"multi_measure_line_chart",name:"multi_measure_line_chart",alias:["multi_measure_line_chart"],family:["LineCharts"],def:"multi_measure_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{let l=null==t?void 0:t.filter(e=>Z(e.levelOfMeasurements,["Interval"])),n=null==t?void 0:t.find(e=>Z(e.levelOfMeasurements,["Nominal"]));if(!n||!l)return null;let a={type:"view",data:e,children:[]};return null==l||l.forEach(e=>{let l={type:"line",encode:{x:N(n.name,t),y:e.name,color:()=>e.name,series:()=>e.name}};a.children.push(l)}),a}catch(e){return console.log(e),null}}},chineseName:"折线图"}],P=e=>"response_line_chart"===e?["multi_line_chart","multi_measure_line_chart"]:"response_bar_chart"===e?["multi_measure_column_chart"]:"response_pie_chart"===e?["pie_chart"]:"response_scatter_chart"===e?["scatter_plot"]:"response_area_chart"===e?["area_chart"]:"response_heatmap_chart"===e?["heatmap"]:[],{Option:k}=x.default,O=e=>{let{data:t,chartType:l,scopeOfCharts:a,ruleConfig:r}=e,[s,c]=(0,m.useState)(),[o,d]=(0,m.useState)([]),[u,h]=(0,m.useState)();(0,m.useEffect)(()=>{c(b({charts:C,scopeOfCharts:void 0,ruleConfig:r}))},[r,a]),(0,m.useEffect)(()=>{if(t&&s){var e;let n=w({data:t,myChartAdvisor:s}),a=function(e){let{advices:t}=e;return t}({advices:n});a.sort((e,t)=>l.indexOf(t.type)-(null==l?void 0:l.indexOf(e.type))),d(a),h(null===(e=a[0])||void 0===e?void 0:e.type)}},[t,s,l]);let _=(0,m.useMemo)(()=>{if((null==o?void 0:o.length)>0){var e,t;let l=null!=u?u:o[0].type,a=null!==(t=null===(e=null==o?void 0:o.find(e=>e.type===l))||void 0===e?void 0:e.spec)&&void 0!==t?t:void 0;if(a)return(0,n.jsx)(i.k,{options:a},l)}},[o,u]);return u?(0,n.jsxs)("div",{children:[(0,n.jsxs)(p.Z,{justify:"start",children:[(0,n.jsx)(f.Z,{children:g.Z.t("Advices")}),(0,n.jsx)(f.Z,{style:{marginLeft:24},children:(0,n.jsx)(x.default,{value:u,placeholder:"Chart Switcher",style:{width:"180px"},onChange:e=>h(e),size:"small",children:null==o?void 0:o.map(e=>{let t=g.Z.t(e.type);return(0,n.jsx)(k,{value:e.type,children:(0,n.jsx)(v.Z,{title:t,placement:"right",children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(j.Z,{}),(0,n.jsx)("div",{style:{marginLeft:"2px"},children:t})]})})},e.type)})})})]}),(0,n.jsx)("div",{className:"auto-chart-content",children:_})]}):(0,n.jsx)(y.Z,{image:y.Z.PRESENTED_IMAGE_SIMPLE,description:"暂无合适的可视化视图"})};var S=function(e){let{chartsData:t}=e,l=(0,m.useMemo)(()=>{if(t){let e=[],l=null==t?void 0:t.filter(e=>"IndicatorValue"===e.chart_type);l.length>0&&e.push({charts:l,type:"IndicatorValue"});let n=null==t?void 0:t.filter(e=>"IndicatorValue"!==e.chart_type),a=n.length,r=0;return[[0],[1],[2],[1,2],[1,3],[2,1,2],[2,1,3],[3,1,3],[3,2,3]][a].forEach(t=>{if(t>0){let l=n.slice(r,r+t);r+=t,e.push({charts:l})}}),e}},[t]);return(0,n.jsx)("div",{className:"flex flex-col gap-3",children:null==l?void 0:l.map((e,t)=>(0,n.jsx)("div",{className:"".concat((null==e?void 0:e.type)!=="IndicatorValue"?"flex gap-3":""),children:e.charts.map(e=>"IndicatorValue"===e.chart_type?(0,n.jsx)("div",{className:"flex flex-row gap-3",children:e.values.map(e=>(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(a.Z,{sx:{background:"transparent"},children:(0,n.jsxs)(r.Z,{className:"justify-around",children:[(0,n.jsx)(s.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,n.jsx)(s.ZP,{children:e.value})]})})},e.name))},e.chart_uid):"LineChart"===e.chart_type?(0,n.jsx)(o,{chart:e},e.chart_uid):"BarChart"===e.chart_type?(0,n.jsx)(c,{chart:e},e.chart_uid):"Table"===e.chart_type?(0,n.jsx)(h,{chart:e},e.chart_uid):void 0)},"chart_row_".concat(t)))})}},34625:function(e,t,l){"use strict";l.d(t,{Z:function(){return O}});var n=l(85893),a=l(67294),r=l(2453),s=l(83062),i=l(31365),c=l(71577),o=l(49591),d=l(88484),u=l(29158),h=l(50489),m=l(41468),x=function(e){var t;let{convUid:l,chatMode:x,onComplete:p,...f}=e,[v,y]=(0,a.useState)(!1),[j,g]=r.ZP.useMessage(),[_,b]=(0,a.useState)([]),[w,Z]=(0,a.useState)(),{model:N}=(0,a.useContext)(m.p),C=async e=>{var t;if(!e){r.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(t=e.file.name)&&void 0!==t?t:"")){r.ZP.error("File type must be csv, xlsx or xls");return}b([e.file])},P=async()=>{y(!0);try{let e=new FormData;e.append("doc_file",_[0]),j.open({content:"Uploading ".concat(_[0].name),type:"loading",duration:0});let[t]=await (0,h.Vx)((0,h.qn)({convUid:l,chatMode:x,data:e,model:N,config:{timeout:36e5,onUploadProgress:e=>{let t=Math.ceil(e.loaded/(e.total||0)*100);Z(t)}}}));if(t)return;r.ZP.success("success"),null==p||p()}catch(e){r.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{y(!1),j.destroy()}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[g,(0,n.jsx)(s.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,n.jsx)(i.default,{disabled:v,className:"mr-1",beforeUpload:()=>!1,fileList:_,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:C,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,n.jsx)(n.Fragment,{}),...f,children:(0,n.jsx)(c.ZP,{className:"flex justify-center items-center",type:"primary",disabled:v,icon:(0,n.jsx)(o.Z,{}),children:"Select File"})})}),(0,n.jsx)(c.ZP,{type:"primary",loading:v,className:"flex justify-center items-center",disabled:!_.length,icon:(0,n.jsx)(d.Z,{}),onClick:P,children:v?100===w?"Analysis":"Uploading":"Upload"}),!!_.length&&(0,n.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",children:[(0,n.jsx)(u.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:null===(t=_[0])||void 0===t?void 0:t.name})]})]})})},p=function(e){let{onComplete:t}=e,{currentDialogue:l,scene:r,chatId:s}=(0,a.useContext)(m.p);return"chat_excel"!==r?null:(0,n.jsx)("div",{className:"max-w-md h-full relative",children:l?(0,n.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,n.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,n.jsx)(u.Z,{className:"text-white"})}),(0,n.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:l.select_param})]}):(0,n.jsx)(x,{convUid:s,chatMode:r,onComplete:t})})};l(23293);var f=l(78045),v=l(16165),y=l(96991),j=l(97821);function g(){let{isContract:e,setIsContract:t,scene:l}=(0,a.useContext)(m.p),r=l&&["chat_with_db_execute","chat_dashboard"].includes(l);return r?(0,n.jsxs)(f.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{t(!e)},children:[(0,n.jsxs)(f.ZP.Button,{value:!1,children:[(0,n.jsx)(v.Z,{component:j.ig,className:"mr-1"}),"Preview"]}),(0,n.jsxs)(f.ZP.Button,{value:!0,children:[(0,n.jsx)(y.Z,{className:"mr-1"}),"Editor"]})]}):null}var _=l(81799),b=l(2093),w=l(51009),Z=function(){let{scene:e,dbParam:t,setDbParam:l}=(0,a.useContext)(m.p),[r,s]=(0,a.useState)({});(0,b.Z)(async()=>{let[,t]=await (0,h.Vx)((0,h.vD)(e));s(null!=t?t:{})},[e]);let i=(0,a.useMemo)(()=>Object.entries(r).map(e=>{let[t,l]=e;return{label:t,value:l}}),[r]);return((0,a.useEffect)(()=>{i.length&&!t&&l(i[0].value)},[i,l,t]),i.length)?(0,n.jsx)(w.default,{value:t,className:"w-36",onChange:e=>{l(e)},children:i.map(e=>(0,n.jsxs)(w.default.Option,{children:[(0,n.jsx)(v.Z,{component:j.NP,className:"mr-1"}),e.label]},e.value))}):null},N=l(577),C=l(11163),P=l(67421),k=function(){let{push:e}=(0,C.useRouter)(),{t}=(0,P.$G)(),{agentList:l,setAgentList:r}=(0,a.useContext)(m.p),{data:s=[]}=(0,N.Z)(async()=>{let[,e]=await (0,h.Vx)((0,h.N6)());return e&&e.length&&(null==r||r([e[0].name])),null!=e?e:[]});return s.length?(0,n.jsx)(w.default,{className:"w-60",value:l,mode:"multiple",maxTagCount:1,maxTagTextLength:12,placeholder:t("Select_Plugins"),options:s.map(e=>({label:e.name,value:e.name})),allowClear:!0,onChange:e=>{null==r||r(e)}}):(0,n.jsx)(c.ZP,{type:"primary",onClick:()=>{e("/agent")},children:t("To_Plugin_Market")})},O=function(e){let{refreshHistory:t,modelChange:l}=e,{scene:r,refreshDialogList:s}=(0,a.useContext)(m.p);return(0,n.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center border-b border-gray-100 gap-1 md:gap-4",children:[(0,n.jsx)(_.Z,{onChange:l}),(0,n.jsx)(Z,{}),"chat_excel"===r&&(0,n.jsx)(p,{onComplete:()=>{null==s||s(),null==t||t()}}),"chat_agent"===r&&(0,n.jsx)(k,{}),(0,n.jsx)(g,{})]})}},81799:function(e,t,l){"use strict";l.d(t,{A:function(){return u}});var n=l(85893),a=l(41468),r=l(51009),s=l(19284),i=l(25675),c=l.n(i),o=l(67294),d=l(67421);function u(e,t){var l;let{width:a,height:r}=t||{};return e?(0,n.jsx)(c(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:a||24,height:r||24,src:(null===(l=s.H[e])||void 0===l?void 0:l.icon)||"/models/huggingface.svg",alt:"llm"}):null}t.Z=function(e){let{onChange:t}=e,{t:l}=(0,d.$G)(),{modelList:i,model:c}=(0,o.useContext)(a.p);return!i||i.length<=0?null:(0,n.jsx)(r.default,{value:c,placeholder:l("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:i.map(e=>{var t;return(0,n.jsx)(r.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[u(e),(0,n.jsx)("span",{className:"ml-2",children:(null===(t=s.H[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},99513:function(e,t,l){"use strict";l.d(t,{Z:function(){return d}});var n=l(85893),a=l(77119),r=l(63764),s=l(94184),i=l.n(s),c=l(67294),o=l(36782);function d(e){let{className:t,value:l,language:a="mysql",onChange:s,thoughts:d}=e,u=(0,c.useMemo)(()=>"mysql"!==a?l:d&&d.length>0?(0,o.WU)("-- ".concat(d," \n").concat(l)):(0,o.WU)(l),[l,d]);return(0,n.jsx)(r.ZP,{className:i()(t),value:u,language:a,onChange:s,theme:"vs-dark",options:{minimap:{enabled:!1},wordWrap:"on"}})}r._m.config({monaco:a})},30119:function(e,t,l){"use strict";l.d(t,{Tk:function(){return c},PR:function(){return o}});var n=l(2453),a=l(6154),r=l(83454);let s=a.Z.create({baseURL:r.env.API_BASE_URL});s.defaults.timeout=1e4,s.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),l(96486);let i={"content-type":"application/json"},c=(e,t)=>{if(t){let l=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");l&&(e+="?".concat(l))}return s.get("/api"+e,{headers:i}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},o=(e,t)=>s.post(e,t,{headers:i}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},23293:function(){}}]);