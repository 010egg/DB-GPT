"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{78543:function(e,t,s){s.d(t,{Z:function(){return y}});var l=s(85893),a=s(67294),n=s(12069),c=s(3363),i=s(67421),r=s(50489),o=s(39479),d=s(59566),m=s(71577);function u(e){let{t}=(0,i.$G)(),{handleAddKnowledge:s}=e,a=async e=>{let{knowledgeName:t,owner:l,description:a}=e,[n,c,i]=await (0,r.Vx)((0,r.U6)({name:t,vector_type:"Chroma",owner:l,desc:a}));(null==i?void 0:i.success)&&s()};return(0,l.jsxs)(o.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:a,children:[(0,l.jsx)(o.Z.Item,{label:t("Knowledge_Space_Name"),name:"knowledgeName",rules:[{required:!0,message:t("Please_input_the_name")},()=>({validator:(e,s)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(s)?Promise.reject(Error(t("the_name_can_only_contain"))):Promise.resolve()})],children:(0,l.jsx)(d.default,{className:"mb-5 h-12",placeholder:t("Please_input_the_name")})}),(0,l.jsx)(o.Z.Item,{label:t("Owner"),name:"owner",rules:[{required:!0,message:t("Please_input_the_owner")}],children:(0,l.jsx)(d.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_owner")})}),(0,l.jsx)(o.Z.Item,{label:t("Description"),name:"description",rules:[{required:!0,message:t("Please_input_the_description")}],children:(0,l.jsx)(d.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_description")})}),(0,l.jsx)(o.Z.Item,{children:(0,l.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:t("Next")})})]})}var h=s(31365),x=s(85813),p=s(72269),_=s(92039),j=s(49591);let f={ChooseType:1,AddDataSourceForm:2},{Dragger:b}=h.default;function g(e){let{handleChooseType:t,documentType:s,step:n,handleBackBtn:c,knowledgeName:u,syncDocuments:b,fetchDocuments:g,setIsAddShow:y}=e,{t:Z}=(0,i.$G)(),{TextArea:w}=d.default,[N,k]=(0,a.useState)([]),[T,P]=(0,a.useState)(!1),v=async e=>{var t;let l;P(!0);let{synchChecked:a,documentName:n,textSource:c,originFileObj:i,text:o,webPageUrl:d}=e;switch(s){case"webPage":l=await (0,r.Vx)((0,r.H_)(u,{doc_name:n,content:d,doc_type:"URL"}));break;case"file":let m=new FormData;m.append("doc_name",N[0].name),m.append("doc_file",N[0]),m.append("doc_type","DOCUMENT"),l=await (0,r.Vx)((0,r.iG)(u,m));break;default:l=await (0,r.Vx)((0,r.H_)(u,{doc_name:n,source:c,content:o,doc_type:"TEXT"}))}P(!1),a&&(null==b||b(u,null==l?void 0:l[1])),(null===(t=l[2])||void 0===t?void 0:t.success)&&(null==y||y(!1),null==g||g())},S=async e=>{k([e.file])},C=[{type:"text",title:Z("Text"),subTitle:Z("Fill your raw text"),iconType:"TEXT"},{type:"webPage",title:Z("URL"),subTitle:Z("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"file",title:Z("Document"),subTitle:Z("Upload_a_document"),iconType:"DOCUMENT"}],D=()=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Z.Item,{label:"".concat(Z("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:Z("Please_input_the_text_source")}],children:(0,l.jsx)(d.default,{className:"mb-5  h-12",placeholder:Z("Please_input_the_text_source")})}),(0,l.jsx)(o.Z.Item,{label:"".concat(Z("Text"),":"),name:"text",rules:[{required:!0,message:Z("Please_input_the_description")}],children:(0,l.jsx)(w,{rows:4,maxLength:6})})]}),I=()=>(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(o.Z.Item,{label:"".concat(Z("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:Z("Please_input_the_owner")}],children:(0,l.jsx)(d.default,{className:"mb-5  h-12",placeholder:Z("Please_input_the_Web_Page_URL")})})}),F=()=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"}),(0,l.jsx)(h.default,{disabled:T,className:"mr-1",beforeUpload:()=>!1,fileList:N,name:"file",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",multiple:!1,onChange:S,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,l.jsx)(l.Fragment,{}),...e,children:(0,l.jsx)(m.ZP,{className:"flex justify-center items-center",type:"primary",disabled:T,icon:(0,l.jsx)(j.Z,{}),children:"Select File"})})]});return n===f.ChooseType?(0,l.jsx)(l.Fragment,{children:C.map((e,s)=>(0,l.jsxs)(x.Z,{className:"mt-4 mb-4",onClick:()=>{t(e)},children:[(0,l.jsxs)("div",{className:"font-semibold",children:[(0,_._)(e.iconType)," ",e.title]}),(0,l.jsx)("div",{children:e.subTitle})]},s))}):(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(o.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:v,children:[(0,l.jsx)(o.Z.Item,{label:"".concat(Z("Name"),":"),name:"documentName",rules:[{required:!0,message:Z("Please_input_the_name")}],children:(0,l.jsx)(d.default,{className:"mb-5 h-12",placeholder:Z("Please_input_the_name")})}),(()=>{switch(s){case"webPage":return I();case"file":return F();default:return D()}})(),(0,l.jsx)(o.Z.Item,{label:"".concat(Z("Synch"),":"),name:"synchChecked",children:(0,l.jsx)(p.Z,{className:"bg-slate-400"})}),(0,l.jsxs)(o.Z.Item,{children:[(0,l.jsx)(m.ZP,{onClick:c,className:"mr-4",children:"".concat(Z("Back"))}),(0,l.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:Z("Finish")})]})]})})}function y(e){let{setIsAddShow:t,isAddShow:s,type:r,knowLedge:o,fetchDocuments:d,fetchKnowledge:m,syncDocuments:h}=e,{t:x}=(0,i.$G)(),p=[{title:x("Knowledge_Space_Config")},{title:x("Choose_a_Datasource_type")},{title:x("Setup_the_Datasource")}],_=[{title:x("Choose_a_Datasource_type")},{title:x("Setup_the_Datasource")}],[j,f]=(0,a.useState)(""),[b,y]=(0,a.useState)(0),Z=async()=>{y(1),null==m||m()},w=e=>{f(e.type),y("knowledge"===r?2:1)},N=()=>{y("knowledge"===r?1:0)};return(0,l.jsxs)(n.default,{title:"knowledge"===r?"Add Knowledge":"Add Datasource",centered:!0,open:s,destroyOnClose:!0,onCancel:()=>{t(!1)},width:1e3,afterClose:()=>{y(0)},footer:null,children:[(0,l.jsx)(c.Z,{current:b,items:"knowledge"===r?p:_}),(()=>{let t="document"===r?b+1:b;return 0===t?(0,l.jsx)(u,{handleAddKnowledge:Z}):(0,l.jsx)(g,{fetchDocuments:d,knowledgeName:null==o?void 0:o.name,step:t,documentType:j,handleChooseType:w,handleBackBtn:N,syncDocuments:h,setIsAddShow:e.setIsAddShow})})()]})}},92039:function(e,t,s){s.d(t,{Z:function(){return L},_:function(){return V}});var l=s(85893),a=s(67294),n=s(12069),c=s(83062),i=s(66309),r=s(85813),o=s(32983),d=s(71577),m=s(42075),u=s(96074),h=s(75081),x=s(27595),p=s(27329),_=s(68346),j=s(21640),f=s(31326),b=s(88008),g=s(27704),y=s(24969),Z=s(18754),w=s(50489),N=s(30381),k=s.n(N),T=s(78543),P=s(59566),v=s(71230),S=s(15746),C=s(39479),D=s(44442),I=s(67421),F=s(31545),A=s(6321);let{TextArea:E}=P.default;function U(e){let{knowledge:t,argumentsShow:s,setArgumentsShow:c}=e,{t:i}=(0,I.$G)(),[r,o]=(0,a.useState)(),m=async()=>{let[e,s]=await (0,w.Vx)((0,w.Tu)(t.name));o(s)};(0,a.useEffect)(()=>{m()},[]);let u=[{key:"Embedding",label:(0,l.jsxs)("div",{children:[(0,l.jsx)(F.Z,{}),i("Embedding")]}),children:(0,l.jsxs)(v.Z,{gutter:24,children:[(0,l.jsx)(S.Z,{span:12,offset:0,children:(0,l.jsx)(C.Z.Item,{tooltip:i("the_top_k_vectors"),rules:[{required:!0}],label:i("topk"),name:["embedding","topk"],children:(0,l.jsx)(P.default,{className:"mb-5 h-12"})})}),(0,l.jsx)(S.Z,{span:12,children:(0,l.jsx)(C.Z.Item,{tooltip:i("Set_a_threshold_score"),rules:[{required:!0}],label:i("recall_score"),name:["embedding","recall_score"],children:(0,l.jsx)(P.default,{className:"mb-5  h-12",placeholder:i("Please_input_the_owner")})})}),(0,l.jsx)(S.Z,{span:12,children:(0,l.jsx)(C.Z.Item,{tooltip:i("Recall_Type"),rules:[{required:!0}],label:i("recall_type"),name:["embedding","recall_type"],children:(0,l.jsx)(P.default,{className:"mb-5  h-12"})})}),(0,l.jsx)(S.Z,{span:12,children:(0,l.jsx)(C.Z.Item,{tooltip:i("A_model_used"),rules:[{required:!0}],label:i("model"),name:["embedding","model"],children:(0,l.jsx)(P.default,{className:"mb-5  h-12"})})}),(0,l.jsx)(S.Z,{span:12,children:(0,l.jsx)(C.Z.Item,{tooltip:i("The_size_of_the_data_chunks"),rules:[{required:!0}],label:i("chunk_size"),name:["embedding","chunk_size"],children:(0,l.jsx)(P.default,{className:"mb-5  h-12"})})}),(0,l.jsx)(S.Z,{span:12,children:(0,l.jsx)(C.Z.Item,{tooltip:i("The_amount_of_overlap"),rules:[{required:!0}],label:i("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,l.jsx)(P.default,{className:"mb-5  h-12",placeholder:i("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,l.jsxs)("div",{children:[(0,l.jsx)(A.Z,{}),i("Embedding")]}),children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.Z.Item,{tooltip:i("A_contextual_parameter"),label:i("scene"),name:["prompt","scene"],children:(0,l.jsx)(E,{rows:4,className:"mb-2"})}),(0,l.jsx)(C.Z.Item,{tooltip:i("structure_or_format"),label:i("template"),name:["prompt","template"],children:(0,l.jsx)(E,{rows:7,className:"mb-2"})}),(0,l.jsx)(C.Z.Item,{tooltip:i("The_maximum_number_of_tokens"),label:i("max_token"),name:["prompt","max_token"],children:(0,l.jsx)(P.default,{className:"mb-2"})})]})}],h=async e=>{let[s,l,a]=await (0,w.Vx)((0,w.iH)(t.name,{argument:JSON.stringify(e)}));(null==a?void 0:a.success)&&c(!1)};return(0,l.jsx)(n.default,{width:850,open:s,onCancel:()=>{c(!1)},footer:null,children:(0,l.jsxs)(C.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...r},autoComplete:"off",onFinish:h,children:[(0,l.jsx)(D.Z,{items:u}),(0,l.jsxs)("div",{className:"mt-3 mb-3",children:[(0,l.jsx)(d.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:i("Submit")}),(0,l.jsx)(d.ZP,{onClick:()=>{c(!1)},children:i("close")})]})]})})}var z=s(11163);let{confirm:q}=n.default,V=e=>"TEXT"===e?(0,l.jsx)(x.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===e?(0,l.jsx)(p.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,l.jsx)(_.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"});function L(e){let{t}=(0,I.$G)(),s=(0,z.useRouter)(),{knowledge:n,setDocumentCount:x}=e,[p,_]=(0,a.useState)(!1),[N,P]=(0,a.useState)([]),[v,S]=(0,a.useState)(!1),[C,D]=(0,a.useState)(!1),F=e=>{q({title:t("Tips"),icon:(0,l.jsx)(j.Z,{}),content:"".concat(t("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await L(e)}})};async function A(){_(!0);let[e,t]=await (0,w.Vx)((0,w._Q)(null==n?void 0:n.name,{page:1,page_size:20}));P(null==t?void 0:t.data),x(String(null==t?void 0:t.total)),_(!1)}let E=async(e,t)=>{await (0,w.Vx)((0,w.Hx)(e,{doc_ids:[t]}))},L=async e=>{await (0,w.Vx)((0,w.n3)(null==n?void 0:n.name,{doc_name:e.doc_name})),A()},R=()=>{S(!0)},G=(e,t)=>{let s;switch(e){case"TODO":s="gold";break;case"RUNNING":s="#2db7f5";break;case"FINISHED":s="#87d068";break;default:s="f50"}return(0,l.jsx)(c.Z,{title:t,children:(0,l.jsx)(i.Z,{color:s,children:e})})};return(0,a.useEffect)(()=>{A()},[n]),(0,l.jsxs)("div",{className:"collapse-container pt-2 px-4",children:[(0,l.jsxs)(m.Z,{children:[(0,l.jsx)(d.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,l.jsx)(y.Z,{}),onClick:R,children:t("Add_Datasource")}),(0,l.jsx)(d.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,l.jsx)(Z.Z,{}),onClick:()=>{D(!0)},children:"Arguments"})]}),(0,l.jsx)(u.Z,{}),(0,l.jsx)(h.Z,{spinning:p,children:N.length>0?(0,l.jsx)("div",{className:"max-h-96 mt-3 grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-5 overflow-auto",children:N.map(e=>(0,l.jsxs)(r.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full",title:(0,l.jsx)(c.Z,{title:e.doc_name,children:(0,l.jsxs)("div",{className:"truncate ",children:[V(e.doc_type),(0,l.jsx)("span",{children:e.doc_name})]})}),extra:(0,l.jsxs)("div",{className:"mx-3",children:[(0,l.jsx)(c.Z,{title:"detail",children:(0,l.jsx)(f.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{s.push("/knowledge/".concat(n.name,"/").concat(e.id))}})}),(0,l.jsx)(c.Z,{title:"Sync",children:(0,l.jsx)(b.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{E(n.name,e.id)}})}),(0,l.jsx)(c.Z,{title:"Delete",children:(0,l.jsx)(g.Z,{className:"text-[#ff1b2e] !text-lg",onClick:()=>{F(e)}})})]}),children:[(0,l.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Size"),":"]}),(0,l.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,l.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Last_Synch"),":"]}),(0,l.jsx)("p",{children:k()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,l.jsx)("p",{className:"mt-2 mb-2",children:G(e.status,e.result)})]},e.id))}):(0,l.jsx)(o.Z,{image:o.Z.PRESENTED_IMAGE_DEFAULT,children:(0,l.jsx)(d.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,l.jsx)(y.Z,{}),onClick:R,children:"Create Now"})})}),(0,l.jsx)(T.Z,{syncDocuments:E,fetchDocuments:A,setIsAddShow:S,isAddShow:v,type:"document",setDocuments:P,knowLedge:n}),(0,l.jsx)(U,{knowledge:n,argumentsShow:C,setArgumentsShow:D})]})}}}]);